{"openapi":"3.1.0","info":{"title":"CycleGraph API","version":"0.1.0"},"paths":{"/api/auth/signup":{"post":{"tags":["auth"],"summary":"Signup","description":"PATCH 1 â€“ Backend: gjÃ¸r signup alltid â€œfreshâ€\n- Ignorer eksisterende cookies\n- Slett eksisterende auth-cookies eksplisitt\n- Deretter opprett ny identitet (uid)","operationId":"signup_api_auth_signup_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SignupIn"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/login":{"post":{"tags":["auth"],"summary":"Login","description":"PATCH 2:\n- Login via login_by_email(email, password) (email->uid index)\n- SignÃ©r cg_auth (COOKIE_NAME)\n- (valgfritt) sett cg_uid=uid som legacy helper cookie","operationId":"login_api_auth_login_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginIn"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/logout":{"post":{"tags":["auth"],"summary":"Logout","operationId":"logout_api_auth_logout_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/auth/me":{"get":{"tags":["auth"],"summary":"Me","description":"Patch 3E:\n- /me bruker kun cg_auth (COOKIE_NAME) som source of truth.\n- cg_uid kan eksistere, men ignoreres som identitet.","operationId":"me_api_auth_me_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/profile/get":{"get":{"tags":["profile"],"summary":"Get Profile","operationId":"get_profile_api_profile_get_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Get Profile Api Profile Get Get"}}}}}}},"/api/profile/save":{"put":{"tags":["profile"],"summary":"Save Profile Route","operationId":"save_profile_route_api_profile_save_put","requestBody":{"content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Body"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Save Profile Route Api Profile Save Put"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/strava/status":{"get":{"tags":["auth-strava"],"summary":"Strava Status","operationId":"strava_status_api_auth_strava_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/auth/strava/login":{"get":{"summary":"Login Alias","description":"Legacy alias: frontend (eller gammel kode) kan sende brukeren hit.\nVi videresender til den \"riktige\" /login-endepunktet, men sÃ¸rger for at\nnext ikke er dobbelt-encodet.","operationId":"login_alias_api_auth_strava_login_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/auth/strava/callback":{"get":{"summary":"Callback Alias","operationId":"callback_alias_api_auth_strava_callback_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/auth/strava/api/auth/strava/login":{"get":{"tags":["auth-strava"],"summary":"Login Alias","description":"Legacy alias: frontend (eller gammel kode) kan sende brukeren hit.\nVi videresender til den \"riktige\" /login-endepunktet, men sÃ¸rger for at\nnext ikke er dobbelt-encodet.","operationId":"login_alias_api_auth_strava_api_auth_strava_login_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/auth/strava/api/auth/strava/callback":{"get":{"tags":["auth-strava"],"summary":"Callback Alias","operationId":"callback_alias_api_auth_strava_api_auth_strava_callback_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/sessions/list":{"get":{"tags":["sessions"],"summary":"List Sessions","description":"Returner en liste over Ã¸kter for innlogget bruker, basert pÃ¥ sessions_index.json\nog result_*.json i logs/results. Skal aldri lekke andre brukeres sessions.","operationId":"list_sessions_api_sessions_list_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"additionalProperties":true,"type":"object"},"type":"array","title":"Response List Sessions Api Sessions List Get"}}}}}}},"/api/sessions/debug/rb":{"post":{"tags":["sessions"],"summary":"Debug Rb","description":"ðŸš« Deprecated / disabled in prod.\nDette var et debug-endepunkt (passthrough til rust) og skal ikke vÃ¦re tilgjengelig.","operationId":"debug_rb_api_sessions_debug_rb_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/sessions/{sid}/analyze":{"post":{"tags":["sessions"],"summary":"Analyze Session","operationId":"analyze_session_api_sessions__sid__analyze_post","parameters":[{"name":"sid","in":"path","required":true,"schema":{"type":"string","title":"Sid"}},{"name":"no_weather","in":"query","required":false,"schema":{"type":"boolean","default":false,"title":"No Weather"}},{"name":"force_recompute","in":"query","required":false,"schema":{"type":"boolean","default":false,"title":"Force Recompute"}},{"name":"debug","in":"query","required":false,"schema":{"type":"integer","default":0,"title":"Debug"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sessions/{sid}/analyze_sessionspy":{"post":{"tags":["sessions"],"summary":"Analyze Session Sessionspy","description":"ðŸš« Deprecated endpoint. Keep for compatibility but do not execute analysis.\nðŸ”’ Auth required (avoid public spam) and do not touch any user data.","operationId":"analyze_session_sessionspy_api_sessions__sid__analyze_sessionspy_post","parameters":[{"name":"sid","in":"path","required":true,"schema":{"type":"string","title":"Sid"}},{"name":"no_weather","in":"query","required":false,"schema":{"type":"boolean","default":false,"title":"No Weather"}},{"name":"force_recompute","in":"query","required":false,"schema":{"type":"boolean","default":false,"title":"Force Recompute"}},{"name":"debug","in":"query","required":false,"schema":{"type":"integer","default":0,"title":"Debug"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sessions/{session_id}":{"get":{"tags":["sessions"],"summary":"Get Session","description":"Returner enkel sessions-respons, med Precision Watt hentet fra\nstate/users/<uid>/results/result_<id>.json (SSOT) eller logs/results/result_<id>.json (fallback).\n\nSikkerhet:\n- Krever auth (401 hvis ikke innlogget)\n- Eiersjekk: session mÃ¥ tilhÃ¸re innlogget bruker, ellers 404\n- SSOT for eierskap = per-user sessions_index.json (ikke doc)\n- Ikke lek ut lokale filpaths i respons","operationId":"get_session_api_sessions__session_id__get","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Response Get Session Api Sessions  Session Id  Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sessions/list/all":{"get":{"tags":["sessions"],"summary":"List All","description":"ðŸ”’ Auth + scope-minimum:\n- Ingen cg_uid-cookie identitet\n- Returnerer kun sessions som ligger i state/users/<user_id>/sessions_index.json","operationId":"list_all_api_sessions_list_all_get","parameters":[{"name":"debug","in":"query","required":false,"schema":{"type":"integer","default":0,"title":"Debug"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Response List All Api Sessions List All Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sessions/list/_debug_paths":{"get":{"tags":["sessions"],"summary":" Debug Paths","description":"ðŸ”’ Auth + scope-minimum:\n- Ikke lek ut absolutt filstruktur (ingen cwd/root/router_file)\n- ReturnÃ©r kun relative paths for current user (state/users/<uid>/...)","operationId":"_debug_paths_api_sessions_list__debug_paths_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response  Debug Paths Api Sessions List  Debug Paths Get"}}}}}}},"/status":{"get":{"summary":"Strava Status","operationId":"strava_status_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/login":{"get":{"summary":"Login","description":"Starter Strava OAuth for INNLOGGET bruker.\n\nPatch 2.2.1:\n- signed state + TTL, fail-closed (state er SSOT)","operationId":"login_login_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/callback":{"get":{"summary":"Callback","description":"Strava redirect callback.\n\nPatch 2.2.1:\n- state mÃ¥ finnes\n- verify signed state + TTL\n- fail-closed hvis state-uid != user_id","operationId":"callback_callback_get","parameters":[{"name":"code","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Code"}},{"name":"state","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"State"}},{"name":"error","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Error"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/strava/sync":{"post":{"tags":["strava-import"],"summary":"Sync Strava Activities","operationId":"sync_strava_activities_api_strava_sync_post","parameters":[{"name":"after","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"description":"Epoch seconds (UTC). If omitted, uses now-days.","title":"After"},"description":"Epoch seconds (UTC). If omitted, uses now-days."},{"name":"before","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"description":"Epoch seconds (UTC). If omitted, uses now.","title":"Before"},"description":"Epoch seconds (UTC). If omitted, uses now."},{"name":"days","in":"query","required":false,"schema":{"type":"integer","maximum":365,"minimum":1,"description":"Used when after is omitted.","default":30,"title":"Days"},"description":"Used when after is omitted."},{"name":"page","in":"query","required":false,"schema":{"type":"integer","maximum":200,"minimum":1,"description":"Strava paging (1..). One page per call.","default":1,"title":"Page"},"description":"Strava paging (1..). One page per call."},{"name":"per_page","in":"query","required":false,"schema":{"type":"integer","maximum":200,"minimum":1,"description":"Strava per_page.","default":50,"title":"Per Page"},"description":"Strava per_page."},{"name":"batch_limit","in":"query","required":false,"schema":{"type":"integer","maximum":200,"minimum":1,"description":"Max rides imported this call.","default":50,"title":"Batch Limit"},"description":"Max rides imported this call."},{"name":"max_activities","in":"query","required":false,"schema":{"type":"integer","maximum":150,"minimum":1,"description":"Early onboarding cap (MVP).","default":150,"title":"Max Activities"},"description":"Early onboarding cap (MVP)."},{"name":"analyze","in":"query","required":false,"schema":{"type":"boolean","description":"Run local analyze step for each ride.","default":true,"title":"Analyze"},"description":"Run local analyze step for each ride."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Response Sync Strava Activities Api Strava Sync Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/strava/import/{rid}":{"post":{"tags":["strava-import"],"summary":"Import Strava Activity","operationId":"import_strava_activity_api_strava_import__rid__post","parameters":[{"name":"rid","in":"path","required":true,"schema":{"type":"string","title":"Rid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Response Import Strava Activity Api Strava Import  Rid  Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/health":{"get":{"summary":"Health","operationId":"health_api_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/sessions/{sid}":{"get":{"summary":"Api Get Session","operationId":"api_get_session_api_sessions__sid__get","parameters":[{"name":"sid","in":"path","required":true,"schema":{"type":"string","title":"Sid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sessions/{sid}/analyze_apppy":{"post":{"summary":"Api Analyze Session Apppy","operationId":"api_analyze_session_apppy_api_sessions__sid__analyze_apppy_post","parameters":[{"name":"sid","in":"path","required":true,"schema":{"type":"string","title":"Sid"}},{"name":"force","in":"query","required":false,"schema":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Force"}},{"name":"x-cyclegraph-force","in":"header","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"X-Cyclegraph-Force"}}],"requestBody":{"content":{"application/json":{"schema":{"anyOf":[{"$ref":"#/components/schemas/AnalyzeRequest2"},{"type":"null"}],"title":"Body"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sessions/{sid}/publish":{"post":{"summary":"Api Publish","operationId":"api_publish_api_sessions__sid__publish_post","parameters":[{"name":"sid","in":"path","required":true,"schema":{"type":"string","title":"Sid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/debug/publish_flags/{sid}":{"get":{"summary":"Debug Flags","operationId":"debug_flags_api_debug_publish_flags__sid__get","parameters":[{"name":"sid","in":"path","required":true,"schema":{"type":"string","title":"Sid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/debug/token_present":{"get":{"summary":"Debug Token Present","operationId":"debug_token_present_api_debug_token_present_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/debug/publish_probe/{sid}":{"get":{"summary":"Debug Publish Probe","operationId":"debug_publish_probe_api_debug_publish_probe__sid__get","parameters":[{"name":"sid","in":"path","required":true,"schema":{"type":"string","title":"Sid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/timeseries/stub":{"get":{"summary":"Timeseries Stub","operationId":"timeseries_stub_api_timeseries_stub_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/sessions/summary":{"get":{"summary":"Sessions Summary","operationId":"sessions_summary_api_sessions_summary_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/favicon.ico":{"get":{"summary":"Favicon","operationId":"favicon_favicon_ico_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"AnalyzeOptions":{"properties":{"force_recompute":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Force Recompute"}},"type":"object","title":"AnalyzeOptions"},"AnalyzeRequest2":{"properties":{"wind_angle_deg":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Wind Angle Deg"},"air_density_kg_per_m3":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Air Density Kg Per M3"},"profile":{"anyOf":[{"$ref":"#/components/schemas/ProfileIn"},{"type":"null"}]},"options":{"anyOf":[{"$ref":"#/components/schemas/AnalyzeOptions"},{"type":"null"}]},"samples":{"anyOf":[{"items":{"$ref":"#/components/schemas/Sample"},"type":"array"},{"type":"null"}],"title":"Samples"},"records":{"anyOf":[{"items":{"$ref":"#/components/schemas/Record"},"type":"array"},{"type":"null"}],"title":"Records"}},"type":"object","title":"AnalyzeRequest2"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"LoginIn":{"properties":{"email":{"type":"string","minLength":3,"title":"Email"},"password":{"type":"string","minLength":8,"title":"Password"}},"type":"object","required":["email","password"],"title":"LoginIn"},"ProfileIn":{"properties":{"CdA":{"anyOf":[{"type":"number","maximum":0.6,"minimum":0.15},{"type":"null"}],"title":"Cda"},"Crr":{"anyOf":[{"type":"number","maximum":0.02,"minimum":0.002},{"type":"null"}],"title":"Crr"},"weight_kg":{"anyOf":[{"type":"number","maximum":150.0,"minimum":35.0},{"type":"null"}],"title":"Weight Kg"},"device":{"anyOf":[{"type":"string","enum":["strava","garmin","zwift","unknown"]},{"type":"null"}],"title":"Device","default":"strava"}},"type":"object","title":"ProfileIn"},"Record":{"properties":{"timestamp_ms":{"type":"integer","title":"Timestamp Ms"},"pw":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Pw"},"np":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Np"},"source":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Source"},"calibrated":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Calibrated"}},"type":"object","required":["timestamp_ms"],"title":"Record"},"Sample":{"properties":{"timestamp_ms":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Timestamp Ms","description":"Epoch ms"},"time":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Time","description":"ISO8601Z"},"lat":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Lat"},"lon":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Lon"},"elev":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Elev"},"speed":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Speed"},"hr":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Hr"},"cadence":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Cadence"},"watts":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Watts"},"temp":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Temp"}},"type":"object","title":"Sample"},"SignupIn":{"properties":{"email":{"type":"string","minLength":3,"title":"Email"},"password":{"type":"string","minLength":8,"title":"Password"}},"type":"object","required":["email","password"],"title":"SignupIn"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}