Definition of Done â€” Frontlog

Samlet oversikt over hva som er ferdig, pÃ¥begynt og planlagt. Ikke-sensitive, hÃ¸ynivÃ¥ punkter.
Sist oppdatert: 2025-09-25

âœ… FERDIG
M1 â€” Prosjektstruktur & repo
Standard repo-oppsett: core/, cli/, docs/, data/, shapes/, tests/.
Init GitHub-repo (README, lisens, .gitignore).
Bygg/kjÃ¸rbare grunnkommandoer dokumentert i README (Rust/Python).
CI eller lokal â€œquick checkâ€: cargo check og enkel Python-kall fungerer.

M2 â€” Rust-core med PyO3
Cargo.toml satt opp med PyO3 av riktig versjon.
Minst Ã©n eksponert Rust-funksjon bundet til Python (importerbar i Python).
cargo test (grunnleggende) og â€œimport i Pythonâ€ fungerer lokalt.
Kodekommentarer: hvor core-API lever og hvordan bygge.

M3 â€” CLI-oppsett & dataflyt
cli/analyze.py kjÃ¸rer ende-til-ende mot core (Rust) med argparse-flagg.
I/O-kontrakt: leser CSV/streams, skriver rapport/JSON til output/.
Grunnleggende feilhÃ¥ndtering (fil mangler, feil format) med tydelige feilmeldinger.
â€œHappy pathâ€ demonstrert pÃ¥ sample data.

M4 â€” Dummydata & testkjÃ¸ring
Dummy/samples tilgjengelig i repo (ikke sensitive).
KjÃ¸reeksempel dokumentert: python -m cli.analyze â€¦ produserer forutsigbar rapport.
Sanity-sjekk: verdier i rapport er konsistente og uten exceptions.
Enkle tester/skript verifiserer flyten.

M5 â€” SHACL-validering
SHACL-shapes for RDF definert i shapes/.
Valideringsscript i Python: kjÃ¸rbar via CLI-flag eller separat kommando.
Eksempelfiler validerer OK; feil rapporteres forstÃ¥elig.
Kort bruksdokumentasjon i docs/ (hva, hvordan, hvor output havner).

M6 â€” Strava-integrasjon (API & import)
OAuth-flyt verifisert; tokens lagres sikkert lokalt (ingen hemmeligheter i repo).
Henting av aktiviteter med paging og tidsfilter (--since) fungerer.
Streams â†’ CSV (minst time,hr,watts), robust hÃ¥ndtering av 401/403/429/5xx.
Inkrementell state (ingen duplikater), og grunnlogg over kjÃ¸ringer.
End-to-end â€œimport â†’ analyzeâ€ fungerer pÃ¥ â‰¥3 reelle Ã¸kter (lokalt verifisert).

M7 â€” Analysefunksjoner (effektivitet, treningsscore)
CGS v1 etablert: IF/NP/VI/Pa:Hr/WpB + 28d baseline (Â±25 %), tydelige fallbacks.
Badges: Big Engine (+6 %, â‰¥30 min) og Metronome (VIâ‰¤1.05, Pa:Hrâ‰¤1.05).
Python: Strava publish-formatter m/ sprÃ¥k, trimming og fallbacks + tester grÃ¸nne.
Rust: unit + golden + perf-guard (2h@1Hz â‰¤200 ms) grÃ¸nne.
Strava-klient: auto-refresh, header-fix, commentâ†’description-fallback, verifisert live.
Docs: CGS_v1, CLI usage, Strava publish oppdatert.

M7.5 â€” Backend-forfining (CGS v1.1, explain)
Systemtest grÃ¸nn pÃ¥ steg 0â€“7: PyO3-import, CLI-hjelp, E2E med sample, idempotens, feilhÃ¥ndtering, Rust/golden, perf-smoke (~0.73s).
SHACL- og Strava-mock-test kan hoppes nÃ¥r ingen .ttl eller mock-data er tilgjengelig.
Fikser gjort: ryddet cmd_session, fikset continue-feil, lagt til mod metrics; i lib.rs (lÃ¸ste E0432), output verifisert deterministisk.

M7.5 â€” Forebyggende tester
Pytest: _analyze_session_bridge() kaster ValueError ved tomme arrays.
Rust golden-test for w_per_beat() med edge-case input (NaN/null/mismatch).
Branch: feature/m7.5-preventive-tests
Tester grÃ¸nne: pytest + cargo test (inkl. golden).
Observasjoner: w_per_beat() hÃ¥ndterer NaN/mismatch robust; logging/Result kan vurderes senere.

M7.5 â€” GitHub Actions (basic CI)
Minimal workflow satt opp: kjÃ¸rer pytest -q og cargo test --tests -q pÃ¥ push/PR.
Branch: feature/m7.5-ci-basic
Tester grÃ¸nne: workflow verifisert OK pÃ¥ GitHub.
Observasjon: base klar for utvidelse med systemtest senere.

M7.6 â€” Strava Fetch & Modusdeteksjon (S1)
Auto-modus basert pÃ¥ trainer, sport_type og device_watts.
CLI-flag --mode roller|outdoor som overstyrer auto.
JSON-output rutes til riktig pipeline (indoor/outdoor).
Tester: pytest + cargo test grÃ¸nne (CLI-parsing, efficiency calc, JSON).
Observasjoner: enkelte Strava-Ã¸kter uten watt (device_watts=False) â†’ policy mÃ¥ avklares.
Branch: feature/strava-fetch-mode

M7.6B â€” No-watt policy & fallback (S1B)
Backend: rute Ã¸kter uten watt eller device_watts=False til hr_only pipeline.
Frontend (senere i M8): vise varsel â€œIngen effekt-data registrert â€“ enkelte metrikker begrenset.â€
Logging: structured WARN med no_power_reason.
Observability: metrics sessions_no_power_total, sessions_device_watts_false_total.
Tester: pytest fixture for device_watts=False og Rust analyzer test (ingen panic, JSON mode="hr_only").
Varsel vises i publish (dry-run).
Branch: feature/no-watt-policy

S2 â€” VÃ¦r & profiler (ğŸŒ¤ï¸)
VÃ¦rklient (vind/temp/trykk) med caching per (lat,lon,timestamp).
Profilsettings (total vekt, sykkeltype, Crr-preset) + validering/defaults (estimat=true).
CLI integrasjon: justert effektivitet basert pÃ¥ vÃ¦rkontekst.
DoD: â‰¥95 % cache-hit ved rekjÃ¸ring; sanity-test hoppes over nÃ¥r publiseringsflyt ikke berÃ¸res.
Status: âœ… Ferdig (pytest + cargo grÃ¸nne, stabile tall Â±1â€“2 W).

S3 â€” Fysikkmotor (ğŸš´)
Kraftmodell: gravitasjon, rulling (Crr), aero (CdA), akselerasjon + drivverkstap.
HÃ¸yde-smoothing i egen modul + outlier-kutt (stopp/sving).
Sample-watt + 5 s glatting + NP/avg i CLI.
DoD: Golden test i CI (Â±1â€“2 W; NP/avg Â±1 W) oppnÃ¥dd; pytest/cargo grÃ¸nn; deterministisk output.
Status: âœ… Ferdig

S4 â€” Kalibrering (CdA/Crr-fit) (ğŸ¯)
Kalibreringsprosedyre (5â€“8 min, 3â€“6 % bakke). Fit CdA/Crr fra data (uten powermeter).
Lagre pr sykkel/profil; bruk globalt i beregninger.
DoD: Reproducible fit pÃ¥ testdata; MAE â‰¤10 % mot powermeter pÃ¥ kalibreringssegment; flagg â€œKalibrert: Ja/Neiâ€.
Status: âœ… Ferdig

S5 â€” Indoor pipeline + GPS/Wind integrasjon (ğŸ§ª)

Indoor/outdoor-pipeline koblet til fysikkmotor m/ vindkorrigering.
CLI-output: watts, wind_rel, v_rel, calibrated, status.
Bonus: Eksponert backend-API for frontend â€” cli/session_api.py: analyze_session() (+ tests/test_api.py), deterministisk JSON for enkel integrasjon i M8.
Golden test med syntetisk GPS+vindfelt etablert.
Unicode-bug i CLI lÃ¸st.
Tester: âœ… cargo/pytest grÃ¸nne, output stabil Â±1â€“2W.

Status: âœ… Ferdig
ğŸ”§ Dynamisk DoD (mÃ¥ alltid vÃ¦re oppfylt)
Robust CLI: Alle subcommands (session, efficiency) kjÃ¸rer uten runtime-feil pÃ¥ gyldige inputfiler.
Profiler: profile.json lagres/lastes; felt calibrated, cda, crr, calibration_mae oppdateres ved kalibrering.

Kalibrering:
MAE â‰¤ 10 % pÃ¥ kalibreringssegment mot powermeter.
Output markerer calibrated: Ja/Nei + reason (nulles ut ved suksess).
Fysikk: Bruker physics-output som baseline (NP/avg, smoothing).
Determinisme: Samme input gir samme output (Â±1â€“2 W).
Tester: cargo test + pytest mÃ¥ vÃ¦re grÃ¸nne i CI.
Observabilitet: CLI og API viser nÃ¸kkelfelter (effektivitet, NP, IF, VI, Pa:Hr, W/beat, kalibrering).
Integrasjon: Rust-kjerne eksponert til Python via PyO3 (analyze_session, rust_calibrate_session).

Nytt (A): Konsistensregler i output
Hvis calibrated=True â†’ reason=None.
NÃ¥r GPS/vind brukes â†’ mode="outdoor".
status avledes fra HR nÃ¥r mulig (ellers behold LIMITED).

ğŸ”œ PLANLAGT (IKKE STARTET) â€“ Frontlog
S6 â€” CLI/Reports & observabilitet (ğŸ“ˆ)
Rapportfelt: NP, Avg, VI, Pa:Hr, W/beat, PrecisionWatt Â±usikkerhet.
Strukturerte logger (level, tidsbruk, cache hits).

Metrics for no-watt (sessions_no_power_total).
Generere rapporter (CSV/JSON) med trender.
Historikk over kalibrering og WPB baseline.
Docs: â€œHow it worksâ€ + â€œKnown limitsâ€.
DoD: deterministisk rapport; loggnivÃ¥ styrbart via flagg/env.

S7 â€” QA & hardening (ğŸ›¡ï¸)
Edge-cases: manglende vÃ¦r, GPS-drift, null HR, kort Ã¸kt.
Flere golden-tester med variasjon i vÃ¦r/terreng.
Golden pÃ¥ ekte ride uten powermeter + plausibilitet mot HR/trend.
OppdatÃ©r CGS v1.1-kobling.
Nytt (B): RefaktorÃ©r testoppsett (conftest.py, test_utils.py) for mindre mocking-knot.
DoD: alle tester grÃ¸nne; CGS konsumerer nye felter uten regress.

S8 â€” Scaffold & dataadapter (ğŸ§©)
React/Tailwind scaffold, routing, state.
Nytt (B): Bruk eksisterende Python-API analyze_session() som backend-adapter (forenkler integrasjon).
DoD: viser Ã©n Ã¸kt (mock) i UI; bytte mockâ†’live via .env.

S9 â€” Ã˜kt-kort & nÃ¸kkelmetrikker (ğŸ“Š)
Ã˜ktvisning: NP, IF, VI, Pa:Hr, W/slag, CGS, PrecisionWatt.
Indoor/outdoor-chip + â€œKalibrert: Ja/Neiâ€.
Varsel-banner for no-watt-Ã¸kter.
DoD: enhetstester for formattere; visuell smoke pÃ¥ mobile/desktop.

S10 â€” Precision Watt UI (ğŸ›ï¸)
Graf/komponent: watt + usikkerhetsbÃ¥nd.
Tooltip: datakilde (powermeter/estimat), vÃ¦rbruk, profil.
DoD: render uten jank med 1 Hz data (2 h Ã¸kt).

S11 â€” Trender & liste (ğŸ—‚ï¸)
Liste over Ã¸kter, enkel filter/sort.
Trendgraf (NP/PrecisionWatt over tid).
DoD: 30+ Ã¸kter fungerer uten lagg; tom-state og feil-state hÃ¥ndteres.

S12 â€” Kalibreringsguide (ğŸ§­)
Onboarding-kort for fÃ¸rste outdoor-Ã¸kt.
Stegvis modal for kalibreringsbakke.
Info for brukere uten wattmÃ¥ler (forklare fallback).
DoD: â€œFerdig kalibrertâ€ trigger backend-flagg; guide kan hoppes.

S13 â€” QA, polish & CI (âœ…)
Tilgjengelighet (kontraster, tastatur).
Liten CI (lint, build, vitest hvis brukt).
Docs: â€œUsing Precision Wattâ€.
DoD: Lighthouse pass (perf>80, a11y>90); build grÃ¸nn i Actions.
CI inkluderer relevante tester per sprint; sanity-test kun ved publisering.