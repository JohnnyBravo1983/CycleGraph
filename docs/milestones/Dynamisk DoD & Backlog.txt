# Definition of Done â€” Frontlog
*Samlet oversikt over hva som er ferdig, pÃ¥begynt og planlagt. Ikke-sensitive, hÃ¸ynivÃ¥ punkter.*

Sist oppdatert: 2025-09-12

---

## âœ… FERDIG

### M1 â€” Prosjektstruktur & repo
- Standard repo-oppsett: `core/`, `cli/`, `docs/`, `data/`, `shapes/`, `tests/`.
- Init GitHub-repo (README, lisens, .gitignore).
- Bygg/kjÃ¸rbare grunnkommandoer dokumentert i README (Rust/Python).
- CI eller lokal â€œquick checkâ€: `cargo check` og enkel Python-kall fungerer.

### M2 â€” Rust-core med PyO3
- Cargo.toml satt opp med PyO3 av riktig versjon.
- Minst Ã©n eksponert Rust-funksjon bundet til Python (importerbar i Python).
- `cargo test` (grunnleggende) og â€œimport i Pythonâ€ fungerer lokalt.
- Kodekommentarer: hvor core-API lever og hvordan bygge.

### M3 â€” CLI-oppsett & dataflyt
- `cli/analyze.py` kjÃ¸rer ende-til-ende mot core (Rust) med argparse-flagg.
- I/O-kontrakt: leser CSV/streams, skriver rapport/JSON til `output/`.
- Grunnleggende feilhÃ¥ndtering (fil mangler, feil format) med tydelige feilmeldinger.
- â€œHappy pathâ€ demonstrert pÃ¥ sample data.

### M4 â€” Dummydata & testkjÃ¸ring
- Dummy/samples tilgjengelig i repo (ikke sensitive).
- KjÃ¸reeksempel dokumentert: `python -m cli.analyze ...` produserer forutsigbar rapport.
- Sanity-sjekk: verdier i rapport er konsistente og uten exceptions.
- Enkle tester/skript verifiserer flyten.

### M5 â€” SHACL-validering
- SHACL-shapes for RDF definert i `shapes/`.
- Valideringsscript i Python: kjÃ¸rbar via CLI-flag eller separat kommando.
- Eksempelfiler validerer OK; feil rapporteres forstÃ¥elig.
- Kort bruksdokumentasjon i `docs/` (hva, hvordan, hvor output havner).

### M6 â€” Strava-integrasjon (API & import)
- OAuth-flyt verifisert; tokens lagres sikkert lokalt (ingen hemmeligheter i repo).
- Henting av aktiviteter med paging og tidsfilter (`--since`) fungerer.
- Streams â†’ CSV (minst `time,hr,watts`), robust hÃ¥ndtering av 401/403/429/5xx.
- Inkrementell state (ingen duplikater), og grunnlogg over kjÃ¸ringer.
- End-to-end â€œimport â†’ analyzeâ€ fungerer pÃ¥ â‰¥3 reelle Ã¸kter (lokalt verifisert).

### M7 â€” Analysefunksjoner (effektivitet, treningsscore)
- CGS v1 etablert: IF/NP/VI/Pa:Hr/WpB + 28d baseline (Â±25 %), tydelige fallbacks.
- Badges: Big Engine (+6 %, â‰¥30 min) og Metronome (VIâ‰¤1.05, Pa:Hrâ‰¤1.05).
- Python: Strava publish-formatter m/ sprÃ¥k, trimming og fallbacks + tester grÃ¸nne.
- Rust: unit + golden + perf-guard (2h@1Hz â‰¤200 ms) grÃ¸nne.
- Strava-klient: auto-refresh, header-fix, commentâ†’description-fallback, verifisert live.
- Docs: CGS_v1, CLI usage, Strava publish oppdatert.

### M7.5 â€” Backend-forfining (CGS v1.1, explain)
- Systemtest grÃ¸nn pÃ¥ steg 0â€“7: PyO3-import, CLI-hjelp, E2E med sample, idempotens, feilhÃ¥ndtering, Rust/golden, perf-smoke (~0.73s).
- SHACL- og Strava-mock-test kan hoppes nÃ¥r ingen `.ttl` eller mock-data er tilgjengelig.
- Fikser gjort: ryddet `cmd_session`, fikset `continue`-feil, lagt til `mod metrics;` i `lib.rs` (lÃ¸ste E0432), output verifisert deterministisk.

### M7.5 â€” Forebyggende tester
- Pytest: `_analyze_session_bridge()` kaster `ValueError` ved tomme arrays.
- Rust golden-test for `w_per_beat()` med edge-case input (NaN/null/mismatch).
- Branch: `feature/m7.5-preventive-tests`
- Tester grÃ¸nne: `pytest` + `cargo test` (inkl. golden).
- Observasjoner: `w_per_beat()` hÃ¥ndterer NaN/mismatch robust; logging/Result kan vurderes senere.

### M7.5 â€” GitHub Actions (basic CI)
- Minimal workflow satt opp: kjÃ¸rer `pytest -q` og `cargo test --tests -q` pÃ¥ push/PR.
- Branch: `feature/m7.5-ci-basic`
- Tester grÃ¸nne: workflow verifisert OK pÃ¥ GitHub.
- Observasjon: base klar for utvidelse med systemtest senere.

### M7.6 â€” Strava Fetch & Modusdeteksjon (S1)
- Auto-modus basert pÃ¥ `trainer`, `sport_type` og `device_watts`.
- CLI-flag `--mode roller|outdoor` som overstyrer auto.
- JSON-output rutes til riktig pipeline (indoor/outdoor).
- Tester: pytest + cargo test grÃ¸nne (CLI-parsing, efficiency calc, JSON).
- Observasjoner: enkelte Strava-Ã¸kter uten watt (`device_watts=False`) â†’ policy mÃ¥ avklares.
- Branch: `feature/strava-fetch-mode`
- Commits: a3f9c12, c7b1e88, f2d4a91

### M7.6B â€” No-watt policy & fallback (S1B) Ferdig
- Backend: rute Ã¸kter uten watt eller device_watts=False til hr_only pipeline.
- Frontend (senere i M8): vise varsel â€œIngen effekt-data registrert â€“ enkelte metrikker begrenset.â€
- Logging: structured WARN med no_power_reason.
- Observability: metrics sessions_no_power_total, sessions_device_watts_false_total.
- Tester: pytest fixture for device_watts=False og Rust analyzer test (ingen panic, JSON mode="hr_only").
- Varsel vises i publish (dry-run).
- Backend: rute Ã¸kter uten watt eller device_watts=False til hr_only-pipeline.
- Frontend (i M8): varsel â€œIngen effekt-data registrert â€“ enkelte metrikker begrenset.â€
- Logging: structured WARN med no_power_reason.
- Observability: metrics sessions_no_power_total, sessions_device_watts_false_total.
---

## ğŸŸ¡ PÃ…BEGYNT
ğŸ”œ PLANLAGT (IKKE STARTET) FrontLog
M7.6 â€” Watt-engine v1 (backend klar) (S2)
- Implementere wattberegning v1 med vÃ¦rdata og sykkeltype som input.
- Utvide Rust-funksjonene, teste med golden tests + live Ã¸kter.
- Perf-sjekk (idempotens, kaldstart < 3s).
- DoD-punkt: oppdater CGS score til v1.1 nÃ¥r implementasjonen fungerer og er testet.
- â€œRepo-rydding planlagt: .gitignore for secrets/state + eksempelfiler for tokens/state.â€).

S2 â€” VÃ¦r & profiler (ğŸŒ¤ï¸) VÃ¦rklient (vind/temp/trykk) m/ caching per (lat,lon,timestamp).
Profilsettings (total vekt, sykkeltype, Crr-preset) + validering/defaults (estimat=true). 
Metrics: weather_cache_hit_total, weather_cache_miss_total. DoD: â‰¥95 % cache-hit ved rekjÃ¸ring
av samme Ã¸kt. ğŸ†• CI-strategi: Sanity-tester (test_strava_client.py) kjÃ¸res kun hvis publiseringsflyt
berÃ¸res. Git hygiene: .gitignore skjuler secrets/state; sample-filer i repo uten sensitive data.
S3 â€” Fysikkmotor (ğŸš´) Kraftmodell: gravitasjon, rulling (Crr), aero (CdA), akselerasjon. HÃ¸yde-smoothing 
(DEM/kalman/savgol), outlier-kutt (stopp/sving). Sample-vis watt + 3â€“5s glatting + NP/avg. DoD: golden 
test pÃ¥ syntetisk segment (flat, bakke, varierende vind); cargo test viser stabile tall (Â±1â€“2W).
ğŸ†• Golden tests inkluderes i CI for stabilitet. Git hygiene: som over.
S4 â€” Kalibrering (CdA/Crr-fit) (ğŸ¯) Kalibreringsprosedyre (5â€“8 min, 3â€“6 % bakke). Fit CdA/Crr fra data
(uten powermeter). Lagre pr sykkel/profil; bruk globalt i beregninger. DoD: reproducible fit pÃ¥ testdata;
MAE â‰¤10 % mot powermeter pÃ¥ kalibreringssegment; flagget â€œKalibrert: Ja/Neiâ€ i output. ğŸ†• Testavhengighet 
fÃ¸lger datastrÃ¸m fra S2 â†’ S3 â†’ S4. Git hygiene: som over.
S5 â€” Indoor-pipeline (ğŸ§ª) Rulle/powermeter: bruk device_watts direkte. Indoor-estimat-modus nÃ¥r watt mangler
(marker tydelig). Idempotens- og perf-tester. DoD: 3 like kjÃ¸ringer â‡’ identisk output; kaldstart <3s. 
Git hygiene: som over.
S6 â€” CLI/Reports & observabilitet (ğŸ“ˆ) Rapportfelt: NP, Avg, VI, Pa:Hr, W/beat, PrecisionWatt Â±usikkerhet.
Strukturerte logger (level, tidsbruk, cache hits). Metrics for no-watt (sessions_no_power_total).
Docs: â€œHow it worksâ€ + â€œKnown limitsâ€. DoD: python -m cli.analyze â€¦ genererer deterministisk rapport;
loggnivÃ¥ styrbart via flagg/env. Git hygiene: som over.
S7 â€” QA & hardening (ğŸ›¡ï¸) Edge-cases: manglende vÃ¦r, GPS-drift, null HR, kort Ã¸kt. Golden pÃ¥ ekte ride
uten powermeter + plausibilitet mot HR/trend. OppdatÃ©r CGS v1.1 kobling. DoD: alle tester grÃ¸nne
(pytest + cargo); CGS konsumerer nye felter uten regress. ğŸ†• RefaktorÃ©r testsetup med helpers (conftest.py, test_utils.py)
for mindre mocking-knot. Git hygiene: som over.
S8 â€” Scaffold & dataadapter (ğŸ§©) React/Tailwind scaffold, routing, state. Adapter mot backend/CLI-output (mock fÃ¸rst).
DoD: viser Ã©n Ã¸kt (mock) i UI; bytte mockâ†’live via .env. Git hygiene: som over.
S9 â€” Ã˜kt-kort & nÃ¸kkelmetrikker (ğŸ“Š) Ã˜ktvisning: NP, IF, VI, Pa:Hr, W/slag, CGS, PrecisionWatt. 
Indoor/outdoor-chip + â€œKalibrert: Ja/Neiâ€. Varsel-banner for no-watt-Ã¸kter. DoD: enhetstester for formattere; 
visuell smoke pÃ¥ mobile/desktop. Git hygiene: som over.
S10 â€” Precision Watt UI (Â±-bÃ¥nd) (ğŸ›ï¸) Graf/komponent som viser watt + usikkerhetsbÃ¥nd. Tooltip: datakilde
(powermeter/estimat), vÃ¦rbruk, profil. DoD: render uten jank med 1Hz data (2h Ã¸kt); skjermbilder/gullstandard
i tests. Git hygiene: som over.
S11 â€” Trender & liste (ğŸ—‚ï¸) Liste over Ã¸kter, enkel filter/sort. Trendgraf (NP/PrecisionWatt over tid). 
DoD: 30+ Ã¸kter fungerer uten merkbar lagg; tom-state og feil-state hÃ¥ndteres. Git hygiene: som over.
S12 â€” Kalibreringsguide (ğŸ§­) Onboarding-kort for fÃ¸rste outdoor-Ã¸kt. â€œKjÃ¸r kalibreringsbakkeâ€ stegvis modal.
Info for brukere uten wattmÃ¥ler (forklare fallback). DoD: â€œFerdig kalibrertâ€ trigger backend-flag; guide kan hoppes over.
Git hygiene: som over.
S13 â€” QA, polish & CI (âœ…) Hurtig tilgjengelighet (kontraster, tastatur). Liten CI (lint, build, vitest hvis brukt).
Docs: â€œUsing Precision Wattâ€. DoD: Lighthouse pass (perf>80, a11y>90); build grÃ¸nn i Actions. ğŸ†• CI inkluderer relevante
tester per sprint; sanity-test kjÃ¸res kun ved publiseringsendringer. Git hygiene: som over.



DoD:
- Lighthouse pass (perf>80, a11y>90).
- Build grÃ¸nn i Actions.

### Notater
- Sensitive nÃ¸kler, ekte tokens og personlige data holdes utenfor repoet.
- Denne DoD-listen er bevisst sanert og hÃ¸ynivÃ¥ for offentlig deling.
- Strukturen â€œFerdig / PÃ¥begynt / Planlagtâ€ gir bÃ¥de frontlog og backlog i ett.



